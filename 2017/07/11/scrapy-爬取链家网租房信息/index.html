<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Python,爬虫,scrapy,链家网,MySQL," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.0" />






<meta name="description" content="本文主要记录学习使用scrapy来获取链家网中北京地区的租房信息，并将获取到的信息存储到MySQL数据库的过程。
本机主要运行环境
Arch Linux
scrapy
MySQL
Python3.6

安装scrapy为了方便安装,以及解决依赖问题,我们选择用pip安装scrapy.1# pip install Scrapy
装好后输入1# scrapy
出现如下图结果：附上scrapy 中文使用">
<meta property="og:type" content="article">
<meta property="og:title" content="scrapy 爬取链家网租房信息">
<meta property="og:url" content="http://yoursite.com/2017/07/11/scrapy-爬取链家网租房信息/index.html">
<meta property="og:site_name" content="Nameless">
<meta property="og:description" content="本文主要记录学习使用scrapy来获取链家网中北京地区的租房信息，并将获取到的信息存储到MySQL数据库的过程。
本机主要运行环境
Arch Linux
scrapy
MySQL
Python3.6

安装scrapy为了方便安装,以及解决依赖问题,我们选择用pip安装scrapy.1# pip install Scrapy
装好后输入1# scrapy
出现如下图结果：附上scrapy 中文使用">
<meta property="og:image" content="http://yoursite.com/images/scrapy.png">
<meta property="og:image" content="http://yoursite.com/images/scrapy2.png">
<meta property="og:image" content="http://yoursite.com/images/scrapy3.png">
<meta property="og:updated_time" content="2017-07-12T01:00:57.950Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="scrapy 爬取链家网租房信息">
<meta name="twitter:description" content="本文主要记录学习使用scrapy来获取链家网中北京地区的租房信息，并将获取到的信息存储到MySQL数据库的过程。
本机主要运行环境
Arch Linux
scrapy
MySQL
Python3.6

安装scrapy为了方便安装,以及解决依赖问题,我们选择用pip安装scrapy.1# pip install Scrapy
装好后输入1# scrapy
出现如下图结果：附上scrapy 中文使用">
<meta name="twitter:image" content="http://yoursite.com/images/scrapy.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/07/11/scrapy-爬取链家网租房信息/"/>





  <title> scrapy 爬取链家网租房信息 | Nameless </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Nameless</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">If you want something you've never had, then you've got to do something you've never done.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/11/scrapy-爬取链家网租房信息/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="The One">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                scrapy 爬取链家网租房信息
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-11T08:43:08+08:00">
                2017-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-爬虫/" itemprop="url" rel="index">
                    <span itemprop="name">Python 爬虫</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本文主要记录学习使用scrapy来获取链家网中北京地区的租房信息，并将获取到的信息存储到MySQL数据库的过程。</p>
<h1 id="本机主要运行环境"><a href="#本机主要运行环境" class="headerlink" title="本机主要运行环境"></a>本机主要运行环境</h1><ul>
<li>Arch Linux</li>
<li>scrapy</li>
<li>MySQL</li>
<li>Python3.6</li>
</ul>
<h1 id="安装scrapy"><a href="#安装scrapy" class="headerlink" title="安装scrapy"></a>安装scrapy</h1><p>为了方便安装,以及解决依赖问题,我们选择用pip安装scrapy.<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># pip install Scrapy</span></div></pre></td></tr></table></figure></p>
<p>装好后输入<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># scrapy</span></div></pre></td></tr></table></figure></p>
<p>出现如下图结果：<br><img src="/images/scrapy.png" alt=""><br>附上<a href="http://scrapy-chs.readthedocs.io/zh_CN/0.24/intro/tutorial.html" target="_blank" rel="external">scrapy 中文使用手册</a>便于使用</p>
<h1 id="初步了解scrapy"><a href="#初步了解scrapy" class="headerlink" title="初步了解scrapy"></a>初步了解scrapy</h1><p>scrapy 目录结构:<br><img src="/images/scrapy2.png" alt=""></p>
<p>文件简要说明:</p>
<ul>
<li>scrapy.cfg: 项目的配置文件,用于配置项目名称、URL等属性</li>
<li>LianjiaSpider/: 该项目的python模块。</li>
<li>LianjiaSpider/items.py: 项目中的item文件.保存爬取到的数据</li>
<li>LianjiaSpider/pipelines.py: 项目中的pipelines文件，将item保存的数据进行处理</li>
<li>LianjiaSpider/settings.py: 项目的设置文件.用于配置爬虫的属性</li>
<li>LianjiaSpider/middlewares.py 项目中间件的配置。例，配置ip池或者UA池</li>
<li>LianjiaSpider/spiders/: 放置爬虫代码的目录.</li>
</ul>
<h1 id="编写爬虫"><a href="#编写爬虫" class="headerlink" title="编写爬虫"></a>编写爬虫</h1><p>先创建个scrapy工程,命令行输入<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># scrapy startproject LianjiaSpider</span></div></pre></td></tr></table></figure></p>
<p>我们在spiders目录下,新建个爬虫文件叫LianjiaSpider.py<br>在这个爬虫文件中，爬虫必须继承scrapy.Spider这个爬虫类<br>此外还必须定义如下三个属性</p>
<ol>
<li>name:定义爬虫名字</li>
<li>star_urls:用于存储待爬取的URL列表</li>
<li>parse():用于解析URL完成下载后Respoense对象,以及生成下一个待处理的URL的Request对象</li>
</ol>
<p>废话不多说，直接上代码<br>LianjiaSpider.py<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding=utf-8 -*-</span></div><div class="line">import scrapy</div><div class="line"><span class="built_in">from</span> ..<span class="keyword">items</span> import LianjiaspiderItem</div><div class="line"></div><div class="line">class LianjiaSpider(scrapy.spiders.Spider):</div><div class="line">    name = <span class="string">'LianjiaSpider'</span> <span class="comment"># 爬虫名称</span></div><div class="line">    start_urls = [] <span class="comment"># 存储爬虫URL</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">101</span>):</div><div class="line">        start_urls.append(<span class="string">'https://bj.lianjia.com/zufang/pg'</span>+str(i)) <span class="comment"># 存储链家网北京租房信息前100页的URL</span></div><div class="line">    allowed_domains = [<span class="string">"linajia.com"</span>]</div><div class="line"></div><div class="line">    def parse(self, response):</div><div class="line">        <span class="keyword">item</span> = LianjiaspiderItem() <span class="comment"># 定义item类的对象用于储存数据</span></div><div class="line">        title_list = response.xpath(<span class="string">"//li[@data-el='zufang']/div[2]/h2/a/text()"</span>).extract() <span class="comment"># 获取所有获取租房标题</span></div><div class="line">        location_list = response.xpath(<span class="string">"//li[@data-el='zufang']/div[2]/div[1]/div[1]/a/span/text()"</span>).extract() <span class="comment"># 获取所有房子地理位置</span></div><div class="line">        zone_list = response.xpath(<span class="string">"//li[@data-el='zufang']/div[2]/div[1]/div[1]/span[1]/span/text()"</span>).extract() <span class="comment"># 获取所有房子厅室信息</span></div><div class="line">        meters_list = response.xpath(<span class="string">"//li[@data-el='zufang']/div[2]/div[1]/div[1]/span[2]/text()"</span>).extract() <span class="comment"># 获取所有房子的平米</span></div><div class="line">        direction_list = response.xpath(<span class="string">"//li[@data-el='zufang']/div[2]/div[1]/div[1]/span[3]/text()"</span>).extract() <span class="comment"># 获取所有房子朝向</span></div><div class="line">        money_list = response.xpath(<span class="string">"//li[@data-el='zufang']/div[2]/div[2]/div[1]/span/text()"</span>).extract() <span class="comment"># 获取所有房子的月租</span></div><div class="line">        <span class="keyword">for</span> i, j, k, l, m, n <span class="keyword">in</span> zip(title_list, location_list, zone_list, meters_list, direction_list, money_list): <span class="comment"># 将每种信息组合在一起,并传给一个item</span></div><div class="line">            <span class="keyword">item</span>[<span class="string">'title'</span>] = i</div><div class="line">            <span class="keyword">item</span>[<span class="string">'location'</span>] = j</div><div class="line">            <span class="keyword">item</span>[<span class="string">'zone'</span>] = k</div><div class="line">            <span class="keyword">item</span>[<span class="string">'meters'</span>] = l</div><div class="line">            <span class="keyword">item</span>[<span class="string">'direction'</span>] = m</div><div class="line">            <span class="keyword">item</span>[<span class="string">'money'</span>] = n</div><div class="line">            yield <span class="keyword">item</span></div></pre></td></tr></table></figure></p>
<p>item.py<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="comment"># Define here the models for your scraped items</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># See documentation in:</span></div><div class="line"><span class="comment"># http://doc.scrapy.org/en/latest/topics/items.html</span></div><div class="line"></div><div class="line">import <span class="keyword">scrapy</span></div><div class="line"></div><div class="line">class LianjiaspiderItem(<span class="keyword">scrapy.Item):</span></div><div class="line">    <span class="comment"># define the fields for your item here like:</span></div><div class="line">    <span class="comment"># name = scrapy.Field()</span></div><div class="line">    title = <span class="keyword">scrapy.Field() </span><span class="comment"># 用于存储房子标题</span></div><div class="line">    location = <span class="keyword">scrapy.Field() </span><span class="comment"># 用于存储地理位置信息</span></div><div class="line">    zone = <span class="keyword">scrapy.Field() </span><span class="comment"># 用户存储房子的厅室信息</span></div><div class="line">    meters = <span class="keyword">scrapy.Field() </span><span class="comment"># 用于存储房子的平米信息</span></div><div class="line">    <span class="keyword">direction </span>= <span class="keyword">scrapy.Field() </span><span class="comment"># 用于存储房子的朝向信息</span></div><div class="line">    money = <span class="keyword">scrapy.Field() </span><span class="comment"># 用于存储房子的月租信息</span></div></pre></td></tr></table></figure></p>
<p>pipelines.py<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="comment"># Define your item pipelines here</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Don't forget to add your pipeline to the ITEM_PIPELINES setting</span></div><div class="line"><span class="comment"># See: http://doc.scrapy.org/en/latest/topics/item-pipeline.html</span></div><div class="line">import MySQLdb</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LianjiaspiderPipeline</span>(<span class="title">object</span>):</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(<span class="keyword">self</span>, spider)</span></span>:</div><div class="line">        <span class="keyword">self</span>.con = MySQLdb.connect(<span class="string">'localhost'</span>, <span class="string">'root'</span>, <span class="string">'密码'</span>, <span class="string">'数据库名字'</span>)</div><div class="line">        <span class="keyword">self</span>.cursor = <span class="keyword">self</span>.con.cursor()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(<span class="keyword">self</span>, item, spider)</span></span>:</div><div class="line">        insert_sql = <span class="string">"INSERT INTO lianjia(TITLE, LOCATION, ZONE, METERS, DIRECTION, MONEY) VALUES ('&#123;&#125;', '&#123;&#125;', '&#123;&#125;', '&#123;&#125;', '&#123;&#125;', '&#123;&#125;')"</span>.format(item[<span class="string">'title'</span>], item[<span class="string">'location'</span>], item[<span class="string">'zone'</span>], item[<span class="string">'meters'</span>], item[<span class="string">'direction'</span>], item[<span class="string">'money'</span>])</div><div class="line">        <span class="keyword">self</span>.cursor.execute(insert_sql) <span class="comment"># 执行sql语句</span></div><div class="line">        <span class="keyword">self</span>.con.commit() <span class="comment"># 提交到数据库，insert和updata语句必须执行这句</span></div><div class="line">        <span class="keyword">return</span> item</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spider_close</span><span class="params">(<span class="keyword">self</span>, spider)</span></span>:</div><div class="line">        <span class="keyword">self</span>.con.close()</div></pre></td></tr></table></figure></p>
<p>在项目配置文件settings.py中添加如下代码<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ITEM_PIPELINES = &#123;</div><div class="line">   <span class="string">'LianjiaSpider.pipelines.LianjiaspiderPipeline'</span>: <span class="number">300</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意：<br>因为scrapy爬虫在请求URL的时候会遵循robots.txt中的协议，恰恰链家网中robots.txt是禁止爬虫爬取根目录的，所以我们要在项目配置文件settings.py中配置<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">ROBOTSTXT_OBEY</span> = <span class="literal">False</span></div></pre></td></tr></table></figure></p>
<h1 id="优化爬虫"><a href="#优化爬虫" class="headerlink" title="优化爬虫"></a>优化爬虫</h1><p>为了使我们的爬虫能够顺利的进行，并且尽量使目标网站不会封禁我们的IP，我们需要如下几种方法去配置爬虫</p>
<ol>
<li><p>禁用cookie,在项目配置文件settings.py中添加</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">COOKIES_ENABLED</span> = <span class="literal">False</span></div></pre></td></tr></table></figure>
</li>
<li><p>设置爬取延迟,在项目配置文件settings.py中添加</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">DOWNLOAD_DELAY</span> = <span class="number">3</span></div></pre></td></tr></table></figure>
</li>
<li><p>设置user_agent池,随机分配user__agent<br> 这里我没用middlewares.py来编写中间件，而是在settings.py的同级目录中新建个中间件useragent_middleware.py，代码如下:</p>
 <figure class="highlight haskell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="title">from</span> scrapy.downloadermiddlewares.useragent <span class="keyword">import</span> UserAgentMiddleware</div><div class="line"><span class="class"></span></div><div class="line"><span class="keyword">class</span> <span class="type">RotateUserAgentMiddleware</span>(<span class="type">UserAgentMiddleware</span>):</div><div class="line">	def __init__(<span class="title">self</span>, <span class="title">user_agent</span>=''):</div><div class="line">	    self.user_agent = user_agent</div><div class="line">	def process_request(<span class="title">self</span>, <span class="title">request</span>, <span class="title">spider</span>):</div><div class="line">	    ua = random.choice(<span class="title">self</span>.<span class="title">user_agent_list</span>)</div><div class="line">	    if ua:</div><div class="line">	        request.headers.setdefault('<span class="type">User</span>-<span class="type">Agent</span>', <span class="title">ua</span>)</div><div class="line">	#the default user_agent_list composes chrome,<span class="type">IE</span>,firefox,<span class="type">Mozilla</span>,opera,netscape</div><div class="line">	#for more user agent strings,you can find it in http://www.useragentstring.com/pages/useragentstring.php</div><div class="line">	user_agent_list = [</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.3.6; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Nexus</span> <span class="type">S</span> <span class="type">Build</span>/<span class="type">GRK39F</span>) <span class="type">AppleWebKit</span>/533.1 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/533.1",</div><div class="line">	"<span class="type">Avant</span> <span class="type">Browser</span>/1.2.789rel1 (<span class="title">http</span>://<span class="title">www</span>.<span class="title">avantbrowser</span>.<span class="title">com</span>)",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="title">en</span>-<span class="type">US</span>) <span class="type">AppleWebKit</span>/532.5 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Chrome</span>/4.0.249.0 <span class="type">Safari</span>/532.5",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 5.2; <span class="title">en</span>-<span class="type">US</span>) <span class="type">AppleWebKit</span>/532.9 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Chrome</span>/5.0.310.0 <span class="type">Safari</span>/532.9",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 5.1; <span class="title">en</span>-<span class="type">US</span>) <span class="type">AppleWebKit</span>/534.7 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Chrome</span>/7.0.514.0 <span class="type">Safari</span>/534.7",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 6.0; <span class="title">en</span>-<span class="type">US</span>) <span class="type">AppleWebKit</span>/534.14 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Chrome</span>/9.0.601.0 <span class="type">Safari</span>/534.14",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="title">en</span>-<span class="type">US</span>) <span class="type">AppleWebKit</span>/534.14 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Chrome</span>/10.0.601.0 <span class="type">Safari</span>/534.14",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="title">en</span>-<span class="type">US</span>) <span class="type">AppleWebKit</span>/534.20 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Chrome</span>/11.0.672.2 <span class="type">Safari</span>/534.20",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="type">WOW64</span>) <span class="type">AppleWebKit</span>/534.27 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Chrome</span>/12.0.712.0 <span class="type">Safari</span>/534.27",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="type">WOW64</span>) <span class="type">AppleWebKit</span>/535.1 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Chrome</span>/13.0.782.24 <span class="type">Safari</span>/535.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span> <span class="type">NT</span> 6.0) <span class="type">AppleWebKit</span>/535.2 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Chrome</span>/15.0.874.120 <span class="type">Safari</span>/535.2",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="type">WOW64</span>) <span class="type">AppleWebKit</span>/535.7 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Chrome</span>/16.0.912.36 <span class="type">Safari</span>/535.7",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 6.0 <span class="title">x64</span>; <span class="title">en</span>-<span class="type">US</span>; <span class="title">rv</span>:1.9<span class="title">pre</span>) <span class="type">Gecko</span>/2008072421 <span class="type">Minefield</span>/3.0.2pre",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 5.1; <span class="title">en</span>-<span class="type">US</span>; <span class="title">rv</span>:1.9.0.10) <span class="type">Gecko</span>/2009042316 <span class="type">Firefox</span>/3.0.10",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 6.0; <span class="title">en</span>-<span class="type">GB</span>; <span class="title">rv</span>:1.9.0.11) <span class="type">Gecko</span>/2009060215 <span class="type">Firefox</span>/3.0.11 (.<span class="type">NET</span> <span class="type">CLR</span> 3.5.30729)",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 6.0; <span class="title">en</span>-<span class="type">US</span>; <span class="title">rv</span>:1.9.1.6) <span class="type">Gecko</span>/20091201 <span class="type">Firefox</span>/3.5.6 <span class="type">GTB5</span>",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">NT</span> 5.1; <span class="title">tr</span>; <span class="title">rv</span>:1.9.2.8) <span class="type">Gecko</span>/20100722 <span class="type">Firefox</span>/3.6.8 ( .<span class="type">NET</span> <span class="type">CLR</span> 3.5.30729; .<span class="type">NET4</span>.0E)",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="title">rv</span>:2.0.1) <span class="type">Gecko</span>/20100101 <span class="type">Firefox</span>/4.0.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="type">Win64</span>; <span class="title">x64</span>; <span class="title">rv</span>:2.0.1) <span class="type">Gecko</span>/20100101 <span class="type">Firefox</span>/4.0.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span> <span class="type">NT</span> 5.1; <span class="title">rv</span>:5.0) <span class="type">Gecko</span>/20100101 <span class="type">Firefox</span>/5.0",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="type">WOW64</span>; <span class="title">rv</span>:6.0<span class="title">a2</span>) <span class="type">Gecko</span>/20110622 <span class="type">Firefox</span>/6.0a2",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="type">WOW64</span>; <span class="title">rv</span>:7.0.1) <span class="type">Gecko</span>/20100101 <span class="type">Firefox</span>/7.0.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span> <span class="type">NT</span> 6.1; <span class="type">WOW64</span>; <span class="title">rv</span>:2.0<span class="title">b4pre</span>) <span class="type">Gecko</span>/20100815 <span class="type">Minefield</span>/4.0b4pre",</div><div class="line">	"<span class="type">Mozilla</span>/4.0 (<span class="title">compatible</span>; <span class="type">MSIE</span> 5.5; <span class="type">Windows</span> <span class="type">NT</span> 5.0 )",</div><div class="line">	"<span class="type">Mozilla</span>/4.0 (<span class="title">compatible</span>; <span class="type">MSIE</span> 5.5; <span class="type">Windows</span> 98; <span class="type">Win</span> 9<span class="title">x</span> 4.90)",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Windows</span> <span class="type">XP</span>) <span class="type">Gecko</span> <span class="type">MultiZilla</span>/1.6.1.0a",</div><div class="line">	"<span class="type">Mozilla</span>/2.02E (<span class="type">Win95</span>; <span class="type">U</span>)",</div><div class="line">	"<span class="type">Mozilla</span>/3.01Gold (<span class="type">Win95</span>; <span class="type">I</span>)",</div><div class="line">	"<span class="type">Mozilla</span>/4.8 [en] (<span class="type">Windows</span> <span class="type">NT</span> 5.1; <span class="type">U</span>)",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Windows</span>; <span class="type">U</span>; <span class="type">Win98</span>; <span class="title">en</span>-<span class="type">US</span>; <span class="title">rv</span>:1.4) <span class="type">Gecko</span> <span class="type">Netscape</span>/7.1 (<span class="title">ax</span>)",</div><div class="line">	"<span class="type">HTC_Dream</span> <span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.5; <span class="title">en</span>-<span class="title">ca</span>; <span class="type">Build</span>/<span class="type">CUPCAKE</span>) <span class="type">AppleWebKit</span>/528.5  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.1.2 <span class="type">Mobile</span> <span class="type">Safari</span>/525.20.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="title">hp</span>-<span class="title">tablet</span>; <span class="type">Linux</span>; <span class="title">hpwOS</span>/3.0.2; <span class="type">U</span>; <span class="title">de</span>-<span class="type">DE</span>) <span class="type">AppleWebKit</span>/534.6 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) wOSBrowser/234.40.1 <span class="type">Safari</span>/534.6 <span class="type">TouchPad</span>/1.0",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.5; <span class="title">en</span>-<span class="title">us</span>; <span class="title">sdk</span> <span class="type">Build</span>/<span class="type">CUPCAKE</span>) <span class="type">AppleWebkit</span>/528.5  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.1.2 <span class="type">Mobile</span> <span class="type">Safari</span>/525.20.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.1; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Nexus</span> <span class="type">One</span> <span class="type">Build</span>/<span class="type">ERD62</span>) <span class="type">AppleWebKit</span>/530.17 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/530.17",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.2; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Nexus</span> <span class="type">One</span> <span class="type">Build</span>/<span class="type">FRF91</span>) <span class="type">AppleWebKit</span>/533.1 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/533.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.5; <span class="title">en</span>-<span class="title">us</span>; <span class="title">htc_bahamas</span> <span class="type">Build</span>/<span class="type">CRB17</span>) <span class="type">AppleWebKit</span>/528.5  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.1.2 <span class="type">Mobile</span> <span class="type">Safari</span>/525.20.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.1-<span class="title">update1</span>; <span class="title">de</span>-<span class="title">de</span>; <span class="type">HTC</span> <span class="type">Desire</span> 1.19.161.5 <span class="type">Build</span>/<span class="type">ERE27</span>) <span class="type">AppleWebKit</span>/530.17 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/530.17",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.2; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Sprint</span> <span class="type">APA9292KT</span> <span class="type">Build</span>/<span class="type">FRF91</span>) <span class="type">AppleWebKit</span>/533.1 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/533.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.5; <span class="title">de</span>-<span class="title">ch</span>; <span class="type">HTC</span> <span class="type">Hero</span> <span class="type">Build</span>/<span class="type">CUPCAKE</span>) <span class="type">AppleWebKit</span>/528.5  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.1.2 <span class="type">Mobile</span> <span class="type">Safari</span>/525.20.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.2; <span class="title">en</span>-<span class="title">us</span>; <span class="type">ADR6300</span> <span class="type">Build</span>/<span class="type">FRF91</span>) <span class="type">AppleWebKit</span>/533.1 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/533.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.1; <span class="title">en</span>-<span class="title">us</span>; <span class="type">HTC</span> <span class="type">Legend</span> <span class="type">Build</span>/<span class="title">cupcake</span>) <span class="type">AppleWebKit</span>/530.17 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/530.17",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.5; <span class="title">de</span>-<span class="title">de</span>; <span class="type">HTC</span> <span class="type">Magic</span> <span class="type">Build</span>/<span class="type">PLAT</span>-<span class="type">RC33</span>) <span class="type">AppleWebKit</span>/528.5  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.1.2 <span class="type">Mobile</span> <span class="type">Safari</span>/525.20.1 <span class="type">FirePHP</span>/0.3",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.6; <span class="title">en</span>-<span class="title">us</span>; <span class="type">HTC_TATTOO_A3288</span> <span class="type">Build</span>/<span class="type">DRC79</span>) <span class="type">AppleWebKit</span>/528.5  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.1.2 <span class="type">Mobile</span> <span class="type">Safari</span>/525.20.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.0; <span class="title">en</span>-<span class="title">us</span>; <span class="title">dream</span>) <span class="type">AppleWebKit</span>/525.10  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.0.4 <span class="type">Mobile</span> <span class="type">Safari</span>/523.12.2",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.5; <span class="title">en</span>-<span class="title">us</span>; <span class="type">T</span>-<span class="type">Mobile</span> <span class="type">G1</span> <span class="type">Build</span>/<span class="type">CRB43</span>) <span class="type">AppleWebKit</span>/528.5  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.1.2 <span class="type">Mobile</span> <span class="type">Safari</span> 525.20.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.5; <span class="title">en</span>-<span class="title">gb</span>; <span class="type">T</span>-<span class="type">Mobile_G2_Touch</span> <span class="type">Build</span>/<span class="type">CUPCAKE</span>) <span class="type">AppleWebKit</span>/528.5  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.1.2 <span class="type">Mobile</span> <span class="type">Safari</span>/525.20.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.0; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Droid</span> <span class="type">Build</span>/<span class="type">ESD20</span>) <span class="type">AppleWebKit</span>/530.17 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/530.17",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.2; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Droid</span> <span class="type">Build</span>/<span class="type">FRG22D</span>) <span class="type">AppleWebKit</span>/533.1 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/533.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.0; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Milestone</span> <span class="type">Build</span>/ <span class="type">SHOLS_U2_01</span>.03.1) <span class="type">AppleWebKit</span>/530.17 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/530.17",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.0.1; <span class="title">de</span>-<span class="title">de</span>; <span class="type">Milestone</span> <span class="type">Build</span>/<span class="type">SHOLS_U2_01</span>.14.0) <span class="type">AppleWebKit</span>/530.17 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/530.17",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 3.0; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Xoom</span> <span class="type">Build</span>/<span class="type">HRI39</span>) <span class="type">AppleWebKit</span>/525.10  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.0.4 <span class="type">Mobile</span> <span class="type">Safari</span>/523.12.2",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 0.5; <span class="title">en</span>-<span class="title">us</span>) <span class="type">AppleWebKit</span>/522  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Safari</span>/419.3",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.1; <span class="title">en</span>-<span class="title">gb</span>; <span class="title">dream</span>) <span class="type">AppleWebKit</span>/525.10  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.0.4 <span class="type">Mobile</span> <span class="type">Safari</span>/523.12.2",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.0; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Droid</span> <span class="type">Build</span>/<span class="type">ESD20</span>) <span class="type">AppleWebKit</span>/530.17 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/530.17",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.1; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Nexus</span> <span class="type">One</span> <span class="type">Build</span>/<span class="type">ERD62</span>) <span class="type">AppleWebKit</span>/530.17 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/530.17",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.2; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Sprint</span> <span class="type">APA9292KT</span> <span class="type">Build</span>/<span class="type">FRF91</span>) <span class="type">AppleWebKit</span>/533.1 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/533.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.2; <span class="title">en</span>-<span class="title">us</span>; <span class="type">ADR6300</span> <span class="type">Build</span>/<span class="type">FRF91</span>) <span class="type">AppleWebKit</span>/533.1 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/533.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 2.2; <span class="title">en</span>-<span class="title">ca</span>; <span class="type">GT</span>-<span class="type">P1000M</span> <span class="type">Build</span>/<span class="type">FROYO</span>) <span class="type">AppleWebKit</span>/533.1 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Mobile</span> <span class="type">Safari</span>/533.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 3.0.1; <span class="title">fr</span>-<span class="title">fr</span>; <span class="type">A500</span> <span class="type">Build</span>/<span class="type">HRI66</span>) <span class="type">AppleWebKit</span>/534.13 (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/4.0 <span class="type">Safari</span>/534.13",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 3.0; <span class="title">en</span>-<span class="title">us</span>; <span class="type">Xoom</span> <span class="type">Build</span>/<span class="type">HRI39</span>) <span class="type">AppleWebKit</span>/525.10  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.0.4 <span class="type">Mobile</span> <span class="type">Safari</span>/523.12.2",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.6; <span class="title">es</span>-<span class="title">es</span>; <span class="type">SonyEricssonX10i</span> <span class="type">Build</span>/<span class="type">R1FA016</span>) <span class="type">AppleWebKit</span>/528.5  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.1.2 <span class="type">Mobile</span> <span class="type">Safari</span>/525.20.1",</div><div class="line">	"<span class="type">Mozilla</span>/5.0 (<span class="type">Linux</span>; <span class="type">U</span>; <span class="type">Android</span> 1.6; <span class="title">en</span>-<span class="title">us</span>; <span class="type">SonyEricssonX10i</span> <span class="type">Build</span>/<span class="type">R1AA056</span>) <span class="type">AppleWebKit</span>/528.5  (<span class="type">KHTML</span>, <span class="title">like</span> <span class="type">Gecko</span>) <span class="type">Version</span>/3.1.2 <span class="type">Mobile</span> <span class="type">Safari</span>/525.20.1",</div><div class="line">]</div></pre></td></tr></table></figure>
<p> 在settings.py添加设置</p>
 <figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">DOWNLOADER_MIDDLEWARES = &#123;</div><div class="line">	<span class="string">'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware'</span><span class="symbol">:None</span>,</div><div class="line">	<span class="string">'LianjiaSpider.useragent_middleware.RotateUserAgentMiddleware'</span><span class="symbol">:</span><span class="number">100</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 其中LianjiaSPider是项目名字;useragent_middleware是UA中间件的文件名字;RotateUserAgentMiddleware是文件中的类</p>
</li>
<li><p>设置proxy池，随机分配ip<br> 因为要设置代理ip，这里可以用<a href="http://www.xicidaili.com/" target="_blank" rel="external">西刺</a>免费的代理ip，尽量选择存活时间长的，速度快的节点。<br> 在settings.py的同级目录下建立一个新的ip池中间件，文件名为proxy_middleware.py，代码如下:</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding=utf-8 -*-</span></div><div class="line">import random</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxyMiddleware</span>(<span class="title">object</span>):</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, ip=<span class="string">''</span>)</span></span>:</div><div class="line">	    <span class="keyword">self</span>.ip = ip</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(<span class="keyword">self</span>, request, spider)</span></span>:</div><div class="line">	    ip = random.choice(<span class="keyword">self</span>.ip_list)</div><div class="line">	    print(ip)</div><div class="line">	    request.meta[<span class="string">'proxy'</span>] = ip</div><div class="line"></div><div class="line">	ip_list =[</div><div class="line">           <span class="string">'https://218.29.111.106:9999'</span>,</div><div class="line">           <span class="string">'https://119.23.129.24:3128'</span>,]</div></pre></td></tr></table></figure>
<p> 在sttings.py中添加设置</p>
 <figure class="highlight roboconf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">DOWNLOADER_MIDDLEWARES = &#123;</div><div class="line">	'<span class="attribute">scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware'</span>: 110,</div><div class="line">	'LianjiaSpider<span class="variable">.proxy_middleware</span><span class="variable">.ProxyMiddleware</span>': 100,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 注意：<br> 如果要爬取目标的URL为http，那么代理ip选择http协议的，否则，代理ip选择https协议的。</p>
</li>
</ol>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>通过本次scrapy的学习，了解到了scrapy 运行机制。简述此过程Scheduler用于存储URL，它将URL传递给Downloader，Downloader请求URL，并将响应传递给Spiders，Spiders有两个主要作用1.对信息进行采集，并传递给Item Pipelines去处理 2.将下一次要请求的URL加入到Scheduler中。附上一张图，供学习使用:<br><img src="/images/scrapy3.png" alt=""><br>有时候用scrapy爬取的数据过多，导致ip被封禁，所以我们要对爬虫的属性进行配置，也就是说编辑settings.py文件，此外还可以设置ip池，和动态分配UA来反反爬虫。<br>更多的scrapy使用技巧会在之后学以致用。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"># Python</a>
          
            <a href="/tags/爬虫/" rel="tag"># 爬虫</a>
          
            <a href="/tags/scrapy/" rel="tag"># scrapy</a>
          
            <a href="/tags/链家网/" rel="tag"># 链家网</a>
          
            <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/07/获取支付宝订单，并存储的数据库/" rel="next" title="Python爬虫模拟登录支付宝并获取订单信息">
                <i class="fa fa-chevron-left"></i> Python爬虫模拟登录支付宝并获取订单信息
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="The One" />
          <p class="site-author-name" itemprop="name">The One</p>
           
              <p class="site-description motion-element" itemprop="description">your life. your learning. your way.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#本机主要运行环境"><span class="nav-number">1.</span> <span class="nav-text">本机主要运行环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装scrapy"><span class="nav-number">2.</span> <span class="nav-text">安装scrapy</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#初步了解scrapy"><span class="nav-number">3.</span> <span class="nav-text">初步了解scrapy</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#编写爬虫"><span class="nav-number">4.</span> <span class="nav-text">编写爬虫</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#优化爬虫"><span class="nav-number">5.</span> <span class="nav-text">优化爬虫</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">6.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">The One</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="true"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  
  
  
    <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  

</body>
</html>
